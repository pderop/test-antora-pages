<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTP Server :: Reactor Netty Reference Guide</title>
    <link rel="prev" href="tcp-client.html">
    <link rel="next" href="http-client.html">
    <meta name="generator" content="Antora 3.2.0-alpha.4">
    <script>
!function (theme, navWidth) {
  if (theme === 'dark') document.documentElement.classList.add('dark-theme')
  if (navWidth) document.documentElement.style.setProperty('--nav-width', `${navWidth}px`)
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)')?.matches && 'dark'),
  localStorage && localStorage.getItem('nav-width'))
    </script>
    <link rel="stylesheet" href="./_/css/site.css">
    <link rel="stylesheet" href="./_/css/vendor/search.css">
    <link rel="stylesheet" href="./_/css/vendor/page-search.css">
    <link rel="stylesheet" href="./_/css/vendor/asciidoctor-tabs.css">

    <meta name="version" content="1.1.18">
    <meta name="component" content="reactor-netty">
    <meta name="latest-version" content="false">
    <link rel="icon" href="./_/img/favicon.ico" type="image/vnd.microsoft.icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://spring.io">
        <img
          id="reactorlogo"
          class="block"
          src="./_/img/reactor-logo.svg"
          alt="Reactor"
        />
        <img
          id="reactorlogo-dark"
          class="block"
          src="./_/img/reactor-logo-dark.svg"
          alt="Reactor"
        />
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <label class="theme-toggler">
      <input
        type="checkbox"
        type="checkbox"
        id="switch-theme-checkbox"
        name="switch-theme-checkbox"
      />
      <span class="icon"><svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fas"
          data-icon="moon"
          class="svg-inline--fa fa-moon moon"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 384 512"
        ><path
            fill="currentColor"
            d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"
          ></path>
        </svg>
        <svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fas"
          data-icon="sun"
          class="svg-inline--fa fa-sun sun"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 512 512"
        ><path
            fill="currentColor"
            d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"
          ></path>
        </svg></span>
      <span class="text">light</span>
    </label>
  </nav>
</header>
<script>
!function (theme) {
  if (theme === 'dark') {
    document.getElementById('switch-theme-checkbox').parentElement.classList.add('active')
  }
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)')?.matches && 'dark'))
</script>
<div class="body">
<div class="nav-container" data-component="reactor-netty" data-version="1.1.18">
  <aside class="nav">
    <div class="panels">
      <div class="nav-panel-menu is-active" data-panel="menu">
        <nav class="nav-menu">
<div class="context">
  <span class="title">Reactor Netty Reference Guide</span>
  <span class="version">1.1.18-SNAPSHOT</span>
  <button class="browse-version" id="browse-version">
    <svg
      height="24px"
      id="Layer_1"
      style="enable-background:new 0 0 512 512;"
      version="1.1"
      viewBox="0 0 512 512"
      width="24px"
      xml:space="preserve"
    ><g><path
          d="M256,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S273.7,224,256,224L256,224z"
        ></path><path
          d="M128.4,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S146,224,128.4,224L128.4,224z"
        ></path><path
          d="M384,224c-17.7,0-32,14.3-32,32s14.3,32,32,32s32-14.3,32-32S401.7,224,384,224L384,224z"
        ></path></g></svg>
  </button>
</div><div class="search">
  <button class="DocSearch-Button search-button">
    <svg enable-background="new 0 0 32 32" id="Glyph" version="1.1" viewBox="0 0 32 32" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <path d="M27.414,24.586l-5.077-5.077C23.386,17.928,24,16.035,24,14c0-5.514-4.486-10-10-10S4,8.486,4,14  s4.486,10,10,10c2.035,0,3.928-0.614,5.509-1.663l5.077,5.077c0.78,0.781,2.048,0.781,2.828,0  C28.195,26.633,28.195,25.367,27.414,24.586z M7,14c0-3.86,3.14-7,7-7s7,3.14,7,7s-3.14,7-7,7S7,17.86,7,14z" id="XMLID_223_"/>
    </svg>
    <span>Search</span>
    <span class="search-key"></span>
  </button>
</div>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">About the Documentation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="getting-started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tcp-server.html">TCP Server</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="tcp-client.html">TCP Client</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="http-server.html">HTTP Server</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="http-client.html">HTTP Client</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="udp-server.html">UDP Server</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="udp-client.html">UDP Client</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="observability.html">Observability</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="faq.html">Frequently Asked Questions</a>
  </li>
</ul>
  </li>
</ul>
          <div class="toggle-sm">
            <button id="nav-toggle-2" class="nav-toggle"></button>
          </div>
        </nav>
      </div>
      <div class="nav-collapse">
        <button id="nav-collapse-toggle"><span></span></button>        
      </div>
    </div>
    <div class="nav-resize"></div>
  </aside>
</div>
<script>
!function (sidebar) {
  if (sidebar) {
    document.body.classList.add('nav-sm')
  }
}(localStorage && localStorage.getItem('sidebar') === 'close')
</script><main class="article">
<div class="toolbar" role="navigation">
  <button id="nav-toggle-1" class="nav-toggle"></button>
<div class="search">
  <button class="DocSearch-Button search-button">
    <svg enable-background="new 0 0 32 32" id="Glyph" version="1.1" viewBox="0 0 32 32" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <path d="M27.414,24.586l-5.077-5.077C23.386,17.928,24,16.035,24,14c0-5.514-4.486-10-10-10S4,8.486,4,14  s4.486,10,10,10c2.035,0,3.928-0.614,5.509-1.663l5.077,5.077c0.78,0.781,2.048,0.781,2.828,0  C28.195,26.633,28.195,25.367,27.414,24.586z M7,14c0-3.86,3.14-7,7-7s7,3.14,7,7s-3.14,7-7,7S7,17.86,7,14z" id="XMLID_223_"/>
    </svg>
    <span>Search</span>
    <span class="search-key"></span>
  </button>
</div>
</div>
  <div class="content">
<aside class="sidebar">
  <div class="content">
    <div
      class="toc"
      data-title="HTTP Server"
      data-levels="2"
    >
      <div class="toc-menu"></div>
    </div>
    <div class="sidebar-links">
        <a href="https://github.com/pderop/test.reactor-netty/edit/main/docs/modules/ROOT/pages/http-server.adoc">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24"
            viewBox="0 0 24 24"
            width="24"
          ><path
              d="m16 2.012 3 3L16.713 7.3l-3-3zM4 14v3h3l8.299-8.287-3-3zm0 6h16v2H4z"
            ></path></svg>
          Edit this Page
        </a>
              <a href="https://github.com/pderop/test.reactor-netty" title="Github">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="512px"
            id="Layer_1"
            version="1.1"
            viewBox="0 0 512 512"
            width="512px"
          ><style type="text/css"><![CDATA[
              .st0{fill-rule:evenodd;clip-rule:evenodd;} ]]></style><g><path
                class="st0"
                d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"
              ></path></g></svg>
          GitHub Project
        </a>
        <a href="https://stackoverflow.com/tags/reactor-netty">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path
              d="M290.7 311L95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 300zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H42.7V320h-40v160h359.5V320h-40z"
            ></path></svg>
          Stack Overflow
        </a>
    </div>
  </div>
</aside><article class="doc">
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Reactor Netty Reference Guide</a></li>
    <li><a href="http-server.html">HTTP Server</a></li>
  </ul>
</nav>
<h1 id="page-title" class="page">HTTP Server</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#starting-and-stopping">1. Starting and Stopping</a>
<ul class="sectlevel2">
<li><a href="#host-and-port">1.1. Host and Port</a></li>
</ul>
</li>
<li><a href="#eager-initialization">2. Eager Initialization</a></li>
<li><a href="#routing-http">3. Routing HTTP</a>
<ul class="sectlevel2">
<li><a href="#sse">3.1. SSE</a></li>
<li><a href="#static-resources">3.2. Static Resources</a></li>
</ul>
</li>
<li><a href="#writing-data">4. Writing Data</a>
<ul class="sectlevel2">
<li><a href="#adding-headers-and-other-metadata">4.1. Adding Headers and Other Metadata</a></li>
<li><a href="#compression">4.2. Compression</a></li>
</ul>
</li>
<li><a href="#consuming-data">5. Consuming Data</a>
<ul class="sectlevel2">
<li><a href="#reading-headers-uri-params-and-other-metadata">5.1. Reading Headers, URI Params, and other Metadata</a></li>
<li><a href="#reading-post-form-or-multipart-data">5.2. Reading Post Form or Multipart Data</a></li>
<li><a href="#http-request-decoder">5.3. HTTP Request Decoder</a></li>
</ul>
</li>
<li><a href="#lifecycle-callbacks">6. Lifecycle Callbacks</a></li>
<li><a href="#tcp-level-configuration">7. TCP-level Configuration</a>
<ul class="sectlevel2">
<li><a href="#wire-logger">7.1. Wire Logger</a></li>
</ul>
</li>
<li><a href="#wire-logger-formatters">8. Wire Logger formatters</a>
<ul class="sectlevel2">
<li><a href="#event-loop-group">8.1. Event Loop Group</a></li>
</ul>
</li>
<li><a href="#ssl-and-tls">9. SSL and TLS</a>
<ul class="sectlevel2">
<li><a href="#server-name-indication">9.1. Server Name Indication</a></li>
</ul>
</li>
<li><a href="#http-access-log">10. HTTP Access Log</a>
<ul class="sectlevel2">
<li><a href="#protocol-selection">10.1. Protocol Selection</a></li>
</ul>
</li>
<li><a href="#metrics">11. Metrics</a></li>
<li><a href="#tracing">12. Tracing</a>
<ul class="sectlevel2">
<li><a href="#access-current-observation">12.1. Access Current Observation</a></li>
</ul>
</li>
<li><a href="#unix-domain-sockets">13. Unix Domain Sockets</a></li>
<li><a href="#http-server-timeout-configuration">14. Timeout Configuration</a>
<ul class="sectlevel2">
<li><a href="#http-server-request-timeout">14.1. Request Timeout</a></li>
<li><a href="#http-server-connection-timeout">14.2. Connection Timeout</a></li>
<li><a href="#http-server-ssl-tls-timeout">14.3. SSL/TLS Timeout</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><code>Reactor Netty</code> provides the easy-to-use and easy-to-configure
<a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/http/server/HttpServer.html"><code>HttpServer</code></a> class.
It hides most of the <code>Netty</code> functionality that is needed in order to create a <code>HTTP</code> server
and adds <code>Reactive Streams</code> backpressure.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="starting-and-stopping"><a class="anchor" href="#starting-and-stopping"></a>1. Starting and Stopping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To start an HTTP server, you must create and configure a
<a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/http/server/HttpServer.html">HttpServer</a> instance.
By default, the <code>host</code> is configured for any local address, and the system picks up an ephemeral port
when the <code>bind</code> operation is invoked.
The following example shows how to create an <code>HttpServer</code> instance:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/create/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()   <i class="conum" data-value="1"></i><b>(1)</b>
				          .bindNow(); <i class="conum" data-value="2"></i><b>(2)</b>

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creates an <a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/http/server/HttpServer.html">HttpServer</a>
instance ready for configuring.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Starts the server in a blocking fashion and waits for it to finish initializing.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The returned <a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/DisposableServer.html"><code>DisposableServer</code></a>
offers a simple server API, including <a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/DisposableChannel.html#disposeNow-java.time.Duration-"><code>disposeNow()</code></a>,
which shuts the server down in a blocking fashion.</p>
</div>
<div class="sect2">
<h3 id="host-and-port"><a class="anchor" href="#host-and-port"></a>1.1. Host and Port</h3>
<div class="paragraph">
<p>To serve on a specific <code>host</code> and <code>port</code>, you can apply the following configuration to the <code>HTTP</code> server:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/address/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .host("localhost") <i class="conum" data-value="1"></i><b>(1)</b>
				          .port(8080)        <i class="conum" data-value="2"></i><b>(2)</b>
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configures the <code>HTTP</code> server host</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configures the <code>HTTP</code> server port</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To serve on multiple addresses, after having configured the <code>HttpServer</code> you can bind it multiple times to obtain separate <code>DisposableServer`s.
All created servers will share resources such as `LoopResources</code> because they use the same configuration instance under the hood.</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/address/MultiAddressApplication.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.core.publisher.Mono;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class MultiAddressApplication {
	public static void main(String[] args) {
		HttpServer httpServer = HttpServer.create();
		DisposableServer server1 = httpServer
				.host("localhost") <i class="conum" data-value="1"></i><b>(1)</b>
				.port(8080)        <i class="conum" data-value="2"></i><b>(2)</b>
				.bindNow();

		DisposableServer server2 = httpServer
				.host("0.0.0.0") <i class="conum" data-value="3"></i><b>(3)</b>
				.port(8081)      <i class="conum" data-value="4"></i><b>(4)</b>
				.bindNow();

		Mono.when(server1.onDispose(), server2.onDispose())
				.block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configures the first <code>HTTP</code> server host</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configures the first <code>HTTP</code> server port</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configures the second <code>HTTP</code> server host</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Configures the second <code>HTTP</code> server port</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="eager-initialization"><a class="anchor" href="#eager-initialization"></a>2. Eager Initialization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the initialization of the <code>HttpServer</code> resources happens on demand. This means that the <code>bind
operation</code> absorbs the extra time needed to initialize and load:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the event loop groups</p>
</li>
<li>
<p>the native transport libraries (when native transport is used)</p>
</li>
<li>
<p>the native libraries for the security (in case of <code>OpenSsl</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you need to preload these resources, you can configure the <code>HttpServer</code> as follows:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/warmup/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		HttpServer httpServer =
				HttpServer.create()
				          .handle((request, response) -&gt; request.receive().then());

		httpServer.warmup() <i class="conum" data-value="1"></i><b>(1)</b>
		          .block();

		DisposableServer server = httpServer.bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initialize and load the event loop groups, the native transport libraries and the native libraries for the security</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="routing-http"><a class="anchor" href="#routing-http"></a>3. Routing HTTP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Defining routes for the <code>HTTP</code> server requires configuring the provided
<a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/http/server/HttpServerRoutes.html"><code>HttpServerRoutes</code></a> builder.
The following example shows how to do so:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/routing/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.core.publisher.Mono;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .route(routes -&gt;
				              routes.get("/hello",        <i class="conum" data-value="1"></i><b>(1)</b>
				                        (request, response) -&gt; response.sendString(Mono.just("Hello World!")))
				                    .post("/echo",        <i class="conum" data-value="2"></i><b>(2)</b>
				                        (request, response) -&gt; response.send(request.receive().retain()))
				                    .get("/path/{param}", <i class="conum" data-value="3"></i><b>(3)</b>
				                        (request, response) -&gt; response.sendString(Mono.just(request.param("param"))))
				                    .ws("/ws",            <i class="conum" data-value="4"></i><b>(4)</b>
				                        (wsInbound, wsOutbound) -&gt; wsOutbound.send(wsInbound.receive().retain())))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Serves a <code>GET</code> request to <code>/hello</code> and returns <code>Hello World!</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Serves a <code>POST</code> request to <code>/echo</code> and returns the received request body as a response.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Serves a <code>GET</code> request to <code>/path/{param}</code> and returns the value of the path parameter.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Serves websocket to <code>/ws</code> and returns the received incoming data as outgoing data.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The server routes are unique and only the first matching in order of declaration is invoked.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="sse"><a class="anchor" href="#sse"></a>3.1. SSE</h3>
<div class="paragraph">
<p>The following code shows how you can configure the <code>HTTP</code> server to serve <code>Server-Sent Events</code>:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/sse/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import com.fasterxml.jackson.databind.ObjectMapper;
import io.netty.buffer.ByteBuf;
import io.netty.buffer.ByteBufAllocator;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Flux;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;
import reactor.netty.http.server.HttpServerRequest;
import reactor.netty.http.server.HttpServerResponse;

import java.io.ByteArrayOutputStream;
import java.nio.charset.Charset;
import java.time.Duration;
import java.util.function.BiFunction;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .route(routes -&gt; routes.get("/sse", serveSse()))
				          .bindNow();

		server.onDispose()
		      .block();
	}

	/**
	 * Prepares SSE response.
	 * The "Content-Type" is "text/event-stream".
	 * The flushing strategy is "flush after every element" emitted by the provided Publisher.
	 */
	private static BiFunction&lt;HttpServerRequest, HttpServerResponse, Publisher&lt;Void&gt;&gt; serveSse() {
		Flux&lt;Long&gt; flux = Flux.interval(Duration.ofSeconds(10));
		return (request, response) -&gt;
		        response.sse()
		                .send(flux.map(Application::toByteBuf), b -&gt; true);
	}

	/**
	 * Transforms the Object to ByteBuf following the expected SSE format.
	 */
	private static ByteBuf toByteBuf(Object any) {
		ByteArrayOutputStream out = new ByteArrayOutputStream();
		try {
			out.write("data: ".getBytes(Charset.defaultCharset()));
			MAPPER.writeValue(out, any);
			out.write("\n\n".getBytes(Charset.defaultCharset()));
		}
		catch (Exception e) {
			throw new RuntimeException(e);
		}
		return ByteBufAllocator.DEFAULT
		                       .buffer()
		                       .writeBytes(out.toByteArray());
	}

	private static final ObjectMapper MAPPER = new ObjectMapper();
}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="static-resources"><a class="anchor" href="#static-resources"></a>3.2. Static Resources</h3>
<div class="paragraph">
<p>The following code shows how you can configure the <code>HTTP</code> server to serve static resources:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/staticresources/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

import java.net.URISyntaxException;
import java.nio.file.Path;
import java.nio.file.Paths;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) throws URISyntaxException {
		Path file = Paths.get(Application.class.getResource("/logback.xml").toURI());
		DisposableServer server =
				HttpServer.create()
				          .route(routes -&gt; routes.file("/index.html", file))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-data"><a class="anchor" href="#writing-data"></a>4. Writing Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To send data to a connected client, you must attach an I/O handler by using either
<a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/http/server/HttpServer.html#handle-java.util.function.BiFunction-"><code>handle(&#8230;&#8203;)</code></a> or
<a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/http/server/HttpServer.html#route-java.util.function.Consumer-"><code>route(&#8230;&#8203;)</code></a>.
The I/O handler has access to <a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/http/server/HttpServerResponse.html"><code>HttpServerResponse</code></a>,
to be able to write data. The following example uses the <code>handle(&#8230;&#8203;)</code> method:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/send/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.core.publisher.Mono;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .handle((request, response) -&gt; response.sendString(Mono.just("hello"))) <i class="conum" data-value="1"></i><b>(1)</b>
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sends <code>hello</code> string to the connected clients</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="adding-headers-and-other-metadata"><a class="anchor" href="#adding-headers-and-other-metadata"></a>4.1. Adding Headers and Other Metadata</h3>
<div class="paragraph">
<p>When you send data to the connected clients, you may need to send additional headers,
cookies, status code, and other metadata.
You can provide this additional metadata by using
<a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/http/server/HttpServerResponse.html"><code>HttpServerResponse</code></a>.
The following example shows how to do so:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/send/headers/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import io.netty.handler.codec.http.HttpHeaderNames;
import io.netty.handler.codec.http.HttpResponseStatus;
import reactor.core.publisher.Mono;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .route(routes -&gt;
				              routes.get("/hello",
				                  (request, response) -&gt;
				                      response.status(HttpResponseStatus.OK)
				                              .header(HttpHeaderNames.CONTENT_LENGTH, "12")
				                              .sendString(Mono.just("Hello World!"))))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="compression"><a class="anchor" href="#compression"></a>4.2. Compression</h3>
<div class="paragraph">
<p>You can configure the <code>HTTP</code> server to send a compressed response, depending on the request header
<code>Accept-Encoding</code>.</p>
</div>
<div class="paragraph">
<p><code>Reactor Netty</code> provides three different strategies for compressing the outgoing data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>compress(boolean)</code>: Depending on the boolean that is provided, the compression is enabled (<code>true</code>) or disabled (<code>false</code>).</p>
</li>
<li>
<p><code>compress(int)</code>: The compression is performed once the response size exceeds the given value (in bytes).</p>
</li>
<li>
<p><code>compress(BiPredicate&lt;HttpServerRequest, HttpServerResponse&gt;)</code>: The compression is performed if
the predicate returns <code>true</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example uses the <code>compress</code> method (set to <code>true</code>) to enable compression:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/compression/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

import java.net.URISyntaxException;
import java.nio.file.Path;
import java.nio.file.Paths;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) throws URISyntaxException {
		Path file = Paths.get(Application.class.getResource("/logback.xml").toURI());
		DisposableServer server =
				HttpServer.create()
				          .compress(true)
				          .route(routes -&gt; routes.file("/index.html", file))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="consuming-data"><a class="anchor" href="#consuming-data"></a>5. Consuming Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To receive data from a connected client, you must attach an I/O handler by using either
<a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/http/server/HttpServer.html#handle-java.util.function.BiFunction-"><code>handle(&#8230;&#8203;)</code></a> or
<a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/http/server/HttpServer.html#route-java.util.function.Consumer-"><code>route(&#8230;&#8203;)</code></a>.
The I/O handler has access to <a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/http/server/HttpServerRequest.html"><code>HttpServerRequest</code></a>,
to be able to read data.</p>
</div>
<div class="paragraph">
<p>The following example uses the <code>handle(&#8230;&#8203;)</code> method:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/read/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .handle((request, response) -&gt; request.receive().then()) <i class="conum" data-value="1"></i><b>(1)</b>
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Receives data from the connected clients</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="reading-headers-uri-params-and-other-metadata"><a class="anchor" href="#reading-headers-uri-params-and-other-metadata"></a>5.1. Reading Headers, URI Params, and other Metadata</h3>
<div class="paragraph">
<p>When you receive data from the connected clients, you might need to check request headers,
parameters, and other metadata. You can obtain this additional metadata by using
<a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/http/server/HttpServerRequest.html"><code>HttpServerRequest</code></a>.
The following example shows how to do so:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/read/headers/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.core.publisher.Mono;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .route(routes -&gt;
				              routes.get("/{param}",
				                  (request, response) -&gt; {
				                      if (request.requestHeaders().contains("Some-Header")) {
				                          return response.sendString(Mono.just(request.param("param")));
				                      }
				                      return response.sendNotFound();
				                  }))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reading-post-form-or-multipart-data"><a class="anchor" href="#reading-post-form-or-multipart-data"></a>5.2. Reading Post Form or Multipart Data</h3>
<div class="paragraph">
<p>When you receive data from the connected clients, you might want to access <code>POST</code> <code>form</code> (<code>application/x-www-form-urlencoded</code>) or
<code>multipart</code> (<code>multipart/form-data</code>) data. You can obtain this data by using
<a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/http/server/HttpServerRequest.html"><code>HttpServerRequest</code></a>.</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/multipart/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.core.publisher.Mono;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .route(routes -&gt;
				              routes.post("/multipart", (request, response) -&gt; response.sendString(
				                      request.receiveForm() <i class="conum" data-value="1"></i><b>(1)</b>
				                             .flatMap(data -&gt; Mono.just('[' + data.getName() + ']')))))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Receives <code>POST</code> form/multipart data.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you need to change the default settings, you can configure the <code>HttpServer</code> or you can provide a configuration per request:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/multipart/custom/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.core.publisher.Mono;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .httpFormDecoder(builder -&gt; builder.maxInMemorySize(0))                  <i class="conum" data-value="1"></i><b>(1)</b>
				          .route(routes -&gt;
				              routes.post("/multipart", (request, response) -&gt; response.sendString(
				                      request.receiveForm(builder -&gt; builder.maxInMemorySize(256)) <i class="conum" data-value="2"></i><b>(2)</b>
				                             .flatMap(data -&gt; Mono.just('[' + data.getName() + ']')))))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configuration on the <code>HttpServer</code> that specifies that the data is stored on disk only.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configuration per request that specifies that if the data size exceed the specified size, the data is stored on the disk.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following listing shows the available configurations:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>baseDirectory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the directory where to store the data on the disk. Default to generated temp directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>charset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <code>Charset</code> for the data. Default to <code>StandardCharsets#UTF_8</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxInMemorySize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the maximum in-memory size per data i.e. the data is written
on disk if the size is greater than <code>maxInMemorySize</code>, else it is in memory.
If set to <code>-1</code> the entire contents is stored in memory. If set to <code>0</code> the entire contents is stored on disk.
Default to <code>16kb</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the maximum size per data. When the limit is reached, an exception is raised.
If set to <code>-1</code> this means no limitation. Default to <code>-1</code> - unlimited.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scheduler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the scheduler to be used for offloading disk operations in the decoding phase.
Default to <code>Schedulers#boundedElastic()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>streaming</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When set to <code>true</code>, the data is streamed directly from the parsed input buffer stream,
which means it is not stored either in memory or file. When <code>false</code>, parts are backed by in-memory and/or file storage.
Default to <code>false</code>.
<strong>NOTE</strong> that with streaming enabled, the provided data might not be in a complete state i.e. <code>HttpData#isCompleted()</code>
has to be checked. Also note that enabling this property effectively ignores <code>maxInMemorySize</code>, <code>baseDirectory</code>, and <code>scheduler</code>.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="obtaining-the-remote-client-address"><a class="anchor" href="#obtaining-the-remote-client-address"></a>5.2.1. Obtaining the Remote (Client) Address</h4>
<div class="paragraph">
<p>In addition to the metadata that you can obtain from the request, you can also receive the
<code>host (server)</code> address, the <code>remote (client)</code> address and the <code>scheme</code>. Depending on the
chosen factory method, you can retrieve the information directly from the channel or by
using the <code>Forwarded</code> or <code>X-Forwarded-*</code> <code>HTTP</code> request headers.
The following example shows how to do so:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/clientaddress/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.core.publisher.Mono;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .forwarded(true) <i class="conum" data-value="1"></i><b>(1)</b>
				          .route(routes -&gt;
				              routes.get("/clientip",
				                  (request, response) -&gt;
				                      response.sendString(Mono.just(request.remoteAddress() <i class="conum" data-value="2"></i><b>(2)</b>
				                                                           .getHostString()))))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specifies that the information about the connection is to be obtained from the <code>Forwarded</code> and <code>X-Forwarded-*</code>
<code>HTTP</code> request headers, if possible.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Returns the address of the remote (client) peer.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also possible to customize the behavior of the <code>Forwarded</code> or <code>X-Forwarded-*</code> header handler.
The following example shows how to do so:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/clientaddress/CustomForwardedHeaderHandlerApplication.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import java.net.InetSocketAddress;

import reactor.core.publisher.Mono;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;
import reactor.netty.transport.AddressUtils;

</span><span class="fold-block">public class CustomForwardedHeaderHandlerApplication {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .forwarded((connectionInfo, request) -&gt; {  <i class="conum" data-value="1"></i><b>(1)</b>
				              String hostHeader = request.headers().get("X-Forwarded-Host");
				              if (hostHeader != null) {
				                  String[] hosts = hostHeader.split(",", 2);
				                  InetSocketAddress hostAddress = AddressUtils.createUnresolved(
				                      hosts[hosts.length - 1].trim(),
				                      connectionInfo.getHostAddress().getPort());
				                  connectionInfo = connectionInfo.withHostAddress(hostAddress);
				              }
				              return connectionInfo;
				          })
				          .route(routes -&gt;
				              routes.get("/clientip",
				                  (request, response) -&gt;
				                      response.sendString(Mono.just(request.remoteAddress() <i class="conum" data-value="2"></i><b>(2)</b>
				                                                           .getHostString()))))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add a custom header handler.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Returns the address of the remote (client) peer.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="http-request-decoder"><a class="anchor" href="#http-request-decoder"></a>5.3. HTTP Request Decoder</h3>
<div class="paragraph">
<p>By default, <code>Netty</code> configures some restrictions for the incoming requests, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The maximum length of the initial line.</p>
</li>
<li>
<p>The maximum length of all headers.</p>
</li>
<li>
<p>The maximum length of the content or each chunk.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://netty.io/4.1/api/io/netty/handler/codec/http/HttpRequestDecoder.html"><code>HttpRequestDecoder</code></a>
and <a href="https://netty.io/4.1/api/io/netty/handler/codec/http/HttpServerUpgradeHandler.html"><code>HttpServerUpgradeHandler</code></a></p>
</div>
<div class="paragraph">
<p>By default, the <code>HTTP</code> server is configured with the following settings:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-http/src/main/java/reactor/netty/http/HttpDecoderSpec.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static final int DEFAULT_MAX_INITIAL_LINE_LENGTH             = 4096;
public static final int DEFAULT_MAX_HEADER_SIZE                     = 8192;
/**
 * Default max chunk size.
 *
 * @deprecated as of 1.1.0. This will be removed in 2.0.0 as Netty 5 does not support this configuration.
 */
@Deprecated
public static final int DEFAULT_MAX_CHUNK_SIZE                      = 8192;
public static final boolean DEFAULT_VALIDATE_HEADERS                = true;
public static final int DEFAULT_INITIAL_BUFFER_SIZE                 = 128;
public static final boolean DEFAULT_ALLOW_DUPLICATE_CONTENT_LENGTHS = false;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-http/src/main/java/reactor/netty/http/server/HttpRequestDecoderSpec.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * The maximum length of the content of the HTTP/2.0 clear-text upgrade request.
 * By default, the server will reject an upgrade request with non-empty content,
 * because the upgrade request is most likely a GET request.
 */
public static final int DEFAULT_H2C_MAX_CONTENT_LENGTH = 0;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you need to change these default settings, you can configure the <code>HTTP</code> server as follows:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/requestdecoder/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.core.publisher.Mono;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .httpRequestDecoder(spec -&gt; spec.maxHeaderSize(16384)) <i class="conum" data-value="1"></i><b>(1)</b>
				          .handle((request, response) -&gt; response.sendString(Mono.just("hello")))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The maximum length of all headers will be <code>16384</code>.
When this value is exceeded, a
<a href="https://netty.io/4.1/api/io/netty/handler/codec/TooLongFrameException.html">TooLongFrameException</a>
is raised.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lifecycle-callbacks"><a class="anchor" href="#lifecycle-callbacks"></a>6. Lifecycle Callbacks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following lifecycle callbacks are provided to let you extend the <code>HttpServer</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Callback</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>doOnBind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invoked when the server channel is about to bind.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>doOnBound</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invoked when the server channel is bound.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>doOnChannelInit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invoked when initializing the channel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>doOnConnection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invoked when a remote client is connected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>doOnUnbound</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invoked when the server channel is unbound.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following example uses the <code>doOnConnection</code> and <code>doOnChannelInit</code> callbacks:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/lifecycle/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import io.netty.handler.logging.LoggingHandler;
import io.netty.handler.timeout.ReadTimeoutHandler;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;
import java.util.concurrent.TimeUnit;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .doOnConnection(conn -&gt;
				              conn.addHandlerFirst(new ReadTimeoutHandler(10, TimeUnit.SECONDS))) <i class="conum" data-value="1"></i><b>(1)</b>
				          .doOnChannelInit((observer, channel, remoteAddress) -&gt;
				              channel.pipeline()
				                     .addFirst(new LoggingHandler("reactor.netty.examples")))    <i class="conum" data-value="2"></i><b>(2)</b>
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Netty</code> pipeline is extended with <code>ReadTimeoutHandler</code> when a remote client is connected.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>Netty</code> pipeline is extended with <code>LoggingHandler</code> when initializing the channel.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tcp-level-configuration"><a class="anchor" href="#tcp-level-configuration"></a>7. TCP-level Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you need to change configuration on the TCP level, you can use the following snippet
to extend the default <code>TCP</code> server configuration:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/channeloptions/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import io.netty.channel.ChannelOption;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .option(ChannelOption.CONNECT_TIMEOUT_MILLIS, 10000)
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="tcp-server.html" class="xref page">TCP Server</a> for more detail about TCP-level configuration.</p>
</div>
<div class="sect2">
<h3 id="wire-logger"><a class="anchor" href="#wire-logger"></a>7.1. Wire Logger</h3>
<div class="paragraph">
<p>Reactor Netty provides wire logging for when the traffic between the peers needs to be inspected.
By default, wire logging is disabled.
To enable it, you must set the logger <code>reactor.netty.http.server.HttpServer</code> level to <code>DEBUG</code>
and apply the following configuration:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/wiretap/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .wiretap(true) <i class="conum" data-value="1"></i><b>(1)</b>
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enables the wire logging</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="wire-logger-formatters"><a class="anchor" href="#wire-logger-formatters"></a>8. Wire Logger formatters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Reactor Netty supports 3 different formatters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/transport/logging/AdvancedByteBufFormat.html#HEX_DUMP">AdvancedByteBufFormat#HEX_DUMP</a> - the default</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-http/src/main/java/reactor/netty/transport/logging/AdvancedByteBufFormat.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * When wire logging is enabled with this format, both events and content will be logged.
 * The content will be in hex format.
 * &lt;p&gt;Examples:&lt;/p&gt;
 * &lt;pre&gt;
 * {@code
 * reactor.netty.http.HttpTests - [d5230a14, L:/0:0:0:0:0:0:0:1:60267 - R:/0:0:0:0:0:0:0:1:60269] REGISTERED
 * reactor.netty.http.HttpTests - [d5230a14, L:/0:0:0:0:0:0:0:1:60267 - R:/0:0:0:0:0:0:0:1:60269] ACTIVE
 * reactor.netty.http.HttpTests - [d5230a14, L:/0:0:0:0:0:0:0:1:60267 - R:/0:0:0:0:0:0:0:1:60269] READ: 145B
 *          +-------------------------------------------------+
 *          |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
 * +--------+-------------------------------------------------+----------------+
 * |00000000| 50 4f 53 54 20 2f 74 65 73 74 2f 57 6f 72 6c 64 |POST /test/World|
 * |00000010| 20 48 54 54 50 2f 31 2e 31 0d 0a 43 6f 6e 74 65 | HTTP/1.1..Conte|
 * |00000020| 6e 74 2d 54 79 70 65 3a 20 74 65 78 74 2f 70 6c |nt-Type: text/pl|
 * |00000030| 61 69 6e 0d 0a 75 73 65 72 2d 61 67 65 6e 74 3a |ain..user-agent:|
 * |00000040| 20 52 65 61 63 74 6f 72 4e 65 74 74 79 2f 64 65 | ReactorNetty/de|
 * ...
 * reactor.netty.http.HttpTests - [d5230a14, L:/0:0:0:0:0:0:0:1:60267 - R:/0:0:0:0:0:0:0:1:60269] WRITE: 38B
 *          +-------------------------------------------------+
 *          |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |
 * +--------+-------------------------------------------------+----------------+
 * |00000000| 48 54 54 50 2f 31 2e 31 20 32 30 30 20 4f 4b 0d |HTTP/1.1 200 OK.|
 * |00000010| 0a 63 6f 6e 74 65 6e 74 2d 6c 65 6e 67 74 68 3a |.content-length:|
 * |00000020| 20 30 0d 0a 0d 0a                               | 0....          |
 * +--------+-------------------------------------------------+----------------+
 * }
 * &lt;/pre&gt;
 */</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/transport/logging/AdvancedByteBufFormat.html#SIMPLE">AdvancedByteBufFormat#SIMPLE</a></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-http/src/main/java/reactor/netty/transport/logging/AdvancedByteBufFormat.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * When wire logging is enabled with this format, only the events will be logged.
 * &lt;p&gt;Examples:&lt;/p&gt;
 * &lt;pre&gt;
 * {@code
 * reactor.netty.http.HttpTests - [230d3686, L:/0:0:0:0:0:0:0:1:60241 - R:/0:0:0:0:0:0:0:1:60245] REGISTERED
 * reactor.netty.http.HttpTests - [230d3686, L:/0:0:0:0:0:0:0:1:60241 - R:/0:0:0:0:0:0:0:1:60245] ACTIVE
 * reactor.netty.http.HttpTests - [230d3686, L:/0:0:0:0:0:0:0:1:60241 - R:/0:0:0:0:0:0:0:1:60245] READ: 145B
 * reactor.netty.http.HttpTests - [230d3686, L:/0:0:0:0:0:0:0:1:60241 - R:/0:0:0:0:0:0:0:1:60245] WRITE: 38B
 * }
 * &lt;/pre&gt;
 */</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/transport/logging/AdvancedByteBufFormat.html#TEXTUAL">AdvancedByteBufFormat#TEXTUAL</a></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-http/src/main/java/reactor/netty/transport/logging/AdvancedByteBufFormat.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * When wire logging is enabled with this format, both events and content will be logged.
 * The content will be in plain text format.
 * &lt;p&gt;Examples:&lt;/p&gt;
 * &lt;pre&gt;
 * {@code
 * reactor.netty.http.HttpTests - [02c3db6c, L:/0:0:0:0:0:0:0:1:60317 - R:/0:0:0:0:0:0:0:1:60319] REGISTERED
 * reactor.netty.http.HttpTests - [02c3db6c, L:/0:0:0:0:0:0:0:1:60317 - R:/0:0:0:0:0:0:0:1:60319] ACTIVE
 * reactor.netty.http.HttpTests - [02c3db6c, L:/0:0:0:0:0:0:0:1:60317 - R:/0:0:0:0:0:0:0:1:60319] READ: 145B POST /test/World HTTP/1.1
 * Content-Type: text/plain
 * user-agent: ReactorNetty/dev
 * ...
 * reactor.netty.http.HttpTests - [02c3db6c, L:/0:0:0:0:0:0:0:1:60317 - R:/0:0:0:0:0:0:0:1:60319] WRITE: 38B HTTP/1.1 200 OK
 * content-length: 0
 * }
 * &lt;/pre&gt;
 */</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you need to change the default formatter you can configure it as follows:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/wiretap/custom/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import io.netty.handler.logging.LogLevel;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;
import reactor.netty.transport.logging.AdvancedByteBufFormat;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .wiretap("logger-name", LogLevel.DEBUG, AdvancedByteBufFormat.TEXTUAL) <i class="conum" data-value="1"></i><b>(1)</b>
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enables the wire logging,
<a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/transport/logging/AdvancedByteBufFormat.html#TEXTUAL">AdvancedByteBufFormat#TEXTUAL</a> is used for
printing the content.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="event-loop-group"><a class="anchor" href="#event-loop-group"></a>8.1. Event Loop Group</h3>
<div class="paragraph">
<p>By default <code>Reactor Netty</code> uses an &#8220;Event Loop Group&#8221;, where the number of the worker threads equals the number of
processors available to the runtime on initialization (but with a minimum value of 4). When you need a different configuration,
you can use one of the <a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/resources/LoopResources.html"><code>LoopResource</code></a><code>#create</code>
methods.</p>
</div>
<div class="paragraph">
<p>The following listing shows the default configuration for the Event Loop Group:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-core/src/main/java/reactor/netty/ReactorNetty.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * Default worker thread count, fallback to available processor
 * (but with a minimum value of 4).
 */
public static final String IO_WORKER_COUNT = "reactor.netty.ioWorkerCount";
/**
 * Default selector thread count, fallback to -1 (no selector thread)
 * &lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; In most use cases using a worker thread also as a selector thread works well.
 * A possible use case for specifying a separate selector thread might be when the worker threads are too busy
 * and connections cannot be accepted fast enough.
 * &lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Although more than 1 can be configured as a selector thread count, in reality
 * only 1 thread will be used as a selector thread.
 */
public static final String IO_SELECT_COUNT = "reactor.netty.ioSelectCount";
/**
 * Default worker thread count for UDP, fallback to available processor
 * (but with a minimum value of 4).
 */
public static final String UDP_IO_THREAD_COUNT = "reactor.netty.udp.ioThreadCount";
/**
 * Default quiet period that guarantees that the disposal of the underlying LoopResources
 * will not happen, fallback to 2 seconds.
 */
public static final String SHUTDOWN_QUIET_PERIOD = "reactor.netty.ioShutdownQuietPeriod";
/**
 * Default maximum amount of time to wait until the disposal of the underlying LoopResources
 * regardless if a task was submitted during the quiet period, fallback to 15 seconds.
 */
public static final String SHUTDOWN_TIMEOUT = "reactor.netty.ioShutdownTimeout";

/**
 * Default value whether the native transport (epoll, kqueue) will be preferred,
 * fallback it will be preferred when available.
 */
public static final String NATIVE = "reactor.netty.native";</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need changes to these settings, you can apply the following configuration:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/eventloop/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;
import reactor.netty.resources.LoopResources;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		LoopResources loop = LoopResources.create("event-loop", 1, 4, true);

		DisposableServer server =
				HttpServer.create()
				          .runOn(loop)
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ssl-and-tls"><a class="anchor" href="#ssl-and-tls"></a>9. SSL and TLS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you need SSL or TLS, you can apply the configuration shown in the next example.
By default, if <code>OpenSSL</code> is available,
<a href="https://netty.io/4.1/api/io/netty/handler/ssl/SslProvider.html#OPENSSL"><code>SslProvider.OPENSSL</code></a>
provider is used as a provider. Otherwise
<a href="https://netty.io/4.1/api/io/netty/handler/ssl/SslProvider.html#JDK"><code>SslProvider.JDK</code></a> is used.
You can switch the provider by using
<a href="https://netty.io/4.1/api/io/netty/handler/ssl/SslContextBuilder.html#sslProvider-io.netty.handler.ssl.SslProvider-"><code>SslContextBuilder</code></a>
or by setting <code>-Dio.netty.handler.ssl.noOpenSsl=true</code>.</p>
</div>
<div class="paragraph">
<p>The following example uses <code>SslContextBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/security/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.netty.DisposableServer;
import reactor.netty.http.Http11SslContextSpec;
import reactor.netty.http.server.HttpServer;
import java.io.File;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		File cert = new File("certificate.crt");
		File key = new File("private.key");

		Http11SslContextSpec http11SslContextSpec = Http11SslContextSpec.forServer(cert, key);

		DisposableServer server =
				HttpServer.create()
				          .secure(spec -&gt; spec.sslContext(http11SslContextSpec))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="server-name-indication"><a class="anchor" href="#server-name-indication"></a>9.1. Server Name Indication</h3>
<div class="paragraph">
<p>You can configure the <code>HTTP</code> server with multiple <code>SslContext</code> mapped to a specific domain.
An exact domain name or a domain name containing a wildcard can be used when configuring the <code>SNI</code> mapping.</p>
</div>
<div class="paragraph">
<p>The following example uses a domain name containing a wildcard:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/sni/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import io.netty.handler.ssl.SslContext;
import io.netty.handler.ssl.SslContextBuilder;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

import java.io.File;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) throws Exception {
		File defaultCert = new File("default_certificate.crt");
		File defaultKey = new File("default_private.key");

		File testDomainCert = new File("default_certificate.crt");
		File testDomainKey = new File("default_private.key");

		SslContext defaultSslContext = SslContextBuilder.forServer(defaultCert, defaultKey).build();
		SslContext testDomainSslContext = SslContextBuilder.forServer(testDomainCert, testDomainKey).build();

		DisposableServer server =
				HttpServer.create()
				          .secure(spec -&gt; spec.sslContext(defaultSslContext)
				                              .addSniMapping("*.test.com",
				                                      testDomainSpec -&gt; testDomainSpec.sslContext(testDomainSslContext)))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-access-log"><a class="anchor" href="#http-access-log"></a>10. HTTP Access Log</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can enable the <code>HTTP</code> access log either programmatically or by configuration. By default, it is disabled.</p>
</div>
<div class="paragraph">
<p>You can use <code>-Dreactor.netty.http.server.accessLogEnabled=true</code> to enable the <code>HTTP</code> access log by configuration.</p>
</div>
<div class="paragraph">
<p>You can use the following configuration (for Logback or similar logging frameworks) to have a separate
<code>HTTP</code> access log file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;appender name="accessLog" class="ch.qos.logback.core.FileAppender"&gt;
    &lt;file&gt;access_log.log&lt;/file&gt;
    &lt;encoder&gt;
        &lt;pattern&gt;%msg%n&lt;/pattern&gt;
    &lt;/encoder&gt;
&lt;/appender&gt;
&lt;appender name="async" class="ch.qos.logback.classic.AsyncAppender"&gt;
    &lt;appender-ref ref="accessLog" /&gt;
&lt;/appender&gt;

&lt;logger name="reactor.netty.http.server.AccessLog" level="INFO" additivity="false"&gt;
    &lt;appender-ref ref="async"/&gt;
&lt;/logger&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example enables it programmatically:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/accessLog/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .accessLog(true)
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling this method takes precedence over the system property configuration.</p>
</div>
<div class="paragraph">
<p>By default, the logging format is <a href="https://en.wikipedia.org/wiki/Common_Log_Format">Common Log Format</a>, but you can
specify a custom one as a parameter, as in the following example:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/accessLog/CustomLogAccessFormatApplication.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;
import reactor.netty.http.server.logging.AccessLog;

</span><span class="fold-block">public class CustomLogAccessFormatApplication {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .accessLog(true, x -&gt; AccessLog.create("method={}, uri={}", x.method(), x.uri()))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also filter <code>HTTP</code> access logs by using the <code>AccessLogFactory#createFilter</code> method, as in the following example:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/accessLog/FilterLogAccessApplication.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;
import reactor.netty.http.server.logging.AccessLogFactory;

</span><span class="fold-block">public class FilterLogAccessApplication {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .accessLog(true, AccessLogFactory.createFilter(p -&gt; !String.valueOf(p.uri()).startsWith("/health/")))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this method can take a custom format parameter too, as in this example:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/accessLog/CustomFormatAndFilterAccessLogApplication.java.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;
import reactor.netty.http.server.logging.AccessLog;
import reactor.netty.http.server.logging.AccessLogFactory;

</span><span class="fold-block">public class CustomFormatAndFilterAccessLogApplication {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .accessLog(true, AccessLogFactory.createFilter(p -&gt; !String.valueOf(p.uri()).startsWith("/health/"), <i class="conum" data-value="1"></i><b>(1)</b>
						          x -&gt; AccessLog.create("method={}, uri={}", x.method(), x.uri()))) <i class="conum" data-value="2"></i><b>(2)</b>
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specifies the filter predicate to use</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specifies the custom format to apply</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>[[http/2]]
== HTTP/2</p>
</div>
<div class="paragraph">
<p>By default, the <code>HTTP</code> server supports <code>HTTP/1.1</code>. If you need <code>HTTP/2</code>, you can get it through configuration.
In addition to the protocol configuration, if you need <code>H2</code> but not <code>H2C (cleartext)</code>, you must also configure SSL.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As Application-Layer Protocol Negotiation (ALPN) is not supported &#8220;out-of-the-box&#8221; by JDK8 (although some vendors backported ALPN to JDK8), you need an additional dependency to a native library that
supports it&#8201;&#8212;&#8201;for example, <a href="https://netty.io/wiki/forked-tomcat-native.html"><code>netty-tcnative-boringssl-static</code></a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following listing presents a simple <code>H2</code> example:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/http2/H2Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.core.publisher.Mono;
import reactor.netty.DisposableServer;
import reactor.netty.http.Http2SslContextSpec;
import reactor.netty.http.HttpProtocol;
import reactor.netty.http.server.HttpServer;
import java.io.File;

</span><span class="fold-block">public class H2Application {

	public static void main(String[] args) {
		File cert = new File("certificate.crt");
		File key = new File("private.key");

		Http2SslContextSpec http2SslContextSpec = Http2SslContextSpec.forServer(cert, key);

		DisposableServer server =
				HttpServer.create()
				          .port(8080)
				          .protocol(HttpProtocol.H2)                            <i class="conum" data-value="1"></i><b>(1)</b>
				          .secure(spec -&gt; spec.sslContext(http2SslContextSpec)) <i class="conum" data-value="2"></i><b>(2)</b>
				          .handle((request, response) -&gt; response.sendString(Mono.just("hello")))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configures the server to support only <code>HTTP/2</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configures <code>SSL</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The application should now behave as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl --http2 https://localhost:8080 -i
HTTP/2 200

hello</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following listing presents a simple <code>H2C</code> example:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/http2/H2CApplication.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.core.publisher.Mono;
import reactor.netty.DisposableServer;
import reactor.netty.http.HttpProtocol;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class H2CApplication {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .port(8080)
				          .protocol(HttpProtocol.H2C)
				          .handle((request, response) -&gt; response.sendString(Mono.just("hello")))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The application should now behave as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl --http2-prior-knowledge http://localhost:8080 -i
HTTP/2 200

hello</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="protocol-selection"><a class="anchor" href="#protocol-selection"></a>10.1. Protocol Selection</h3>
<div class="listingblock">
<div class="title">example$reactor-netty-http/src/main/java/reactor/netty/http/HttpProtocol.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public enum HttpProtocol {

	/**
	 * The default supported HTTP protocol by HttpServer and HttpClient.
	 */
	HTTP11,

	/**
	 * HTTP/2.0 support with TLS
	 * &lt;p&gt;If used along with HTTP/1.1 protocol, HTTP/2.0 will be the preferred protocol.
	 * While negotiating the application level protocol, HTTP/2.0 or HTTP/1.1 can be chosen.
	 * &lt;p&gt;If used without HTTP/1.1 protocol, HTTP/2.0 will always be offered as a protocol
	 * for communication with no fallback to HTTP/1.1.
	 */
	H2,

	/**
	 * HTTP/2.0 support with clear-text.
	 * &lt;p&gt;If used along with HTTP/1.1 protocol, will support H2C "upgrade":
	 * Request or consume requests as HTTP/1.1 first, looking for HTTP/2.0 headers
	 * and {@literal Connection: Upgrade}. A server will typically reply a successful
	 * 101 status if upgrade is successful or a fallback HTTP/1.1 response. When
	 * successful the client will start sending HTTP/2.0 traffic.
	 * &lt;p&gt;If used without HTTP/1.1 protocol, will support H2C "prior-knowledge": Doesn't
	 * require {@literal Connection: Upgrade} handshake between a client and server but
	 * fallback to HTTP/1.1 will not be supported.
	 */
	H2C
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metrics"><a class="anchor" href="#metrics"></a>11. Metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The HTTP server supports built-in integration with <a href="https://micrometer.io/"><code>Micrometer</code></a>.
It exposes all metrics with a prefix of <code>reactor.netty.http.server</code>.</p>
</div>
<div class="paragraph">
<p>The following table provides information for the HTTP server metrics:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">metric name</th>
<th class="tableblock halign-left valign-top">type</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.http.server.streams.active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of active HTTP/2 streams.
See <a href="observability.html#observability-metrics-streams-active" class="xref page">observability.adoc#observability-metrics-streams-active</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.http.server.connections.active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of http connections currently processing requests.
See <a href="observability.html#observability-metrics-connections-active" class="xref page">observability.adoc#observability-metrics-connections-active</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.http.server.connections.total</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of all opened connections.
See <a href="observability.html#observability-metrics-connections-total" class="xref page">observability.adoc#observability-metrics-connections-total</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.http.server.data.received</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DistributionSummary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amount of the data received, in bytes.
See <a href="observability.html#observability-metrics-data-received" class="xref page">observability.adoc#observability-metrics-data-received</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.http.server.data.sent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DistributionSummary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amount of the data sent, in bytes.
See <a href="observability.html#observability-metrics-data-sent" class="xref page">observability.adoc#observability-metrics-data-sent</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.http.server.errors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of errors that occurred.
See <a href="observability.html#observability-metrics-errors-count" class="xref page">observability.adoc#observability-metrics-errors-count</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.http.server.data.received.time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time spent in consuming incoming data.
See <a href="observability.html#observability-metrics-http-server-data-received-time" class="xref page">observability.adoc#observability-metrics-http-server-data-received-time</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.http.server.data.sent.time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time spent in sending outgoing data.
See <a href="observability.html#observability-metrics-http-server-data-sent-time" class="xref page">observability.adoc#observability-metrics-http-server-data-sent-time</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.http.server.response.time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total time for the request/response
See <a href="observability.html#observability-metrics-http-server-response-time" class="xref page">observability.adoc#observability-metrics-http-server-response-time</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These additional metrics are also available:</p>
</div>
<div class="paragraph">
<p><code>ByteBufAllocator</code> metrics</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">metric name</th>
<th class="tableblock halign-left valign-top">type</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.bytebuf.allocator.used.heap.memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of bytes reserved by heap buffer allocator.
See <a href="#observability-metrics-used-heap-memory">[observability-metrics-used-heap-memory]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.bytebuf.allocator.used.direct.memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of bytes reserved by direct buffer allocator.
See <a href="#observability-metrics-used-direct-memory">[observability-metrics-used-direct-memory]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.bytebuf.allocator.heap.arenas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of heap arenas (when <code>PooledByteBufAllocator</code>).
See <a href="#observability-metrics-heap-arenas">[observability-metrics-heap-arenas]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.bytebuf.allocator.direct.arenas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of direct arenas (when <code>PooledByteBufAllocator</code>).
See <a href="#observability-metrics-direct-arenas">[observability-metrics-direct-arenas]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.bytebuf.allocator.threadlocal.caches</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of thread local caches (when <code>PooledByteBufAllocator</code>).
See <a href="#observability-metrics-thread-local-caches">[observability-metrics-thread-local-caches]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.bytebuf.allocator.small.cache.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size of the small cache (when <code>PooledByteBufAllocator</code>).
See <a href="#observability-metrics-small-cache-size">[observability-metrics-small-cache-size]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.bytebuf.allocator.normal.cache.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size of the normal cache (when <code>PooledByteBufAllocator</code>).
See <a href="#observability-metrics-normal-cache-size">[observability-metrics-normal-cache-size]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.bytebuf.allocator.chunk.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The chunk size for an arena (when <code>PooledByteBufAllocator</code>).
See <a href="#observability-metrics-chunk-size">[observability-metrics-chunk-size]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.bytebuf.allocator.active.heap.memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The actual bytes consumed by in-use buffers allocated from heap buffer pools (when <code>PooledByteBufAllocator</code>).
See <a href="#observability-metrics-active-heap-memory">[observability-metrics-active-heap-memory]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.bytebuf.allocator.active.direct.memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The actual bytes consumed by in-use buffers allocated from direct buffer pools (when <code>PooledByteBufAllocator</code>).
See <a href="#observability-metrics-active-direct-memory">[observability-metrics-active-direct-memory]</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>EventLoop</code> metrics</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">metric name</th>
<th class="tableblock halign-left valign-top">type</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reactor.netty.eventloop.pending.tasks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gauge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of tasks that are pending for processing on an event loop.
See <a href="#observability-metrics-pending-tasks">[observability-metrics-pending-tasks]</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following example enables that integration:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/metrics/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import io.micrometer.core.instrument.Metrics;
import io.micrometer.core.instrument.config.MeterFilter;
import reactor.core.publisher.Mono;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		Metrics.globalRegistry <i class="conum" data-value="1"></i><b>(1)</b>
		       .config()
		       .meterFilter(MeterFilter.maximumAllowableTags("reactor.netty.http.server", "URI", 100, MeterFilter.deny()));

		DisposableServer server =
				HttpServer.create()
				          .metrics(true, s -&gt; {
				              if (s.startsWith("/stream/")) { <i class="conum" data-value="2"></i><b>(2)</b>
				                  return "/stream/{n}";
				              }
				              else if (s.startsWith("/bytes/")) {
				                  return "/bytes/{n}";
				              }
				              return s;
				          }) <i class="conum" data-value="3"></i><b>(3)</b>
				          .route(r -&gt;
				              r.get("/stream/{n}",
				                   (req, res) -&gt; res.sendString(Mono.just(req.param("n"))))
				               .get("/bytes/{n}",
				                   (req, res) -&gt; res.sendString(Mono.just(req.param("n")))))
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Applies upper limit for the meters with <code>URI</code> tag</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Templated URIs will be used as an URI tag value when possible</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Enables the built-in integration with Micrometer</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In order to avoid a memory and CPU overhead of the enabled metrics, it is important to convert the real URIs to templated URIs when possible.
Without a conversion to a template-like form, each distinct URI leads to the creation of a distinct tag, which takes a lot of memory for the metrics.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Always apply an upper limit for the meters with URI tags. Configuring an upper limit on the number of meters can help in cases when the real URIs cannot be templated.
You can find more information at <a href="https://micrometer.io/docs/concepts#_denyaccept_meters"><code>maximumAllowableTags</code></a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When HTTP server metrics are needed for an integration with a system other than <code>Micrometer</code> or you want
to provide your own integration with <code>Micrometer</code>, you can provide your own metrics recorder, as follows:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/metrics/custom/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.core.publisher.Mono;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;
import reactor.netty.http.server.HttpServerMetricsRecorder;

import java.net.SocketAddress;
import java.time.Duration;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .metrics(true, CustomHttpServerMetricsRecorder::new) <i class="conum" data-value="1"></i><b>(1)</b>
				          .route(r -&gt;
				              r.get("/stream/{n}",
				                   (req, res) -&gt; res.sendString(Mono.just(req.param("n"))))
				               .get("/bytes/{n}",
				                   (req, res) -&gt; res.sendString(Mono.just(req.param("n")))))
				          .bindNow();

		server.onDispose()
		      .block();
	}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enables HTTP server metrics and provides <a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/http/server/HttpServerMetricsRecorder.html"><code>HttpServerMetricsRecorder</code></a> implementation.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tracing"><a class="anchor" href="#tracing"></a>12. Tracing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The HTTP server supports built-in integration with <a href="https://micrometer.io/docs/tracing"><code>Micrometer Tracing</code></a>.</p>
</div>
<div class="paragraph">
<p>The following table provides information for the HTTP server spans:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">contextual name</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;HTTP METHOD&gt;_&lt;URI&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Information and total time for the request.
See <a href="observability.html#observability-spans-http-server-response-span" class="xref page">observability.adoc#observability-spans-http-server-response-span</a>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following example enables that integration. This concrete example uses <code>Brave</code> and reports the information to <code>Zipkin</code>.
See the <a href="https://micrometer.io/docs/tracing#_micrometer_tracing_opentelemetry_setup"><code>Micrometer Tracing</code></a> documentation for <code>OpenTelemetry</code> setup.</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/tracing/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import brave.Tracing;
import brave.handler.SpanHandler;
import brave.propagation.StrictCurrentTraceContext;
import brave.sampler.Sampler;
import io.micrometer.tracing.CurrentTraceContext;
import io.micrometer.tracing.Tracer;
import io.micrometer.tracing.brave.bridge.BraveBaggageManager;
import io.micrometer.tracing.brave.bridge.BraveCurrentTraceContext;
import io.micrometer.tracing.brave.bridge.BravePropagator;
import io.micrometer.tracing.brave.bridge.BraveTracer;
import io.micrometer.tracing.propagation.Propagator;
import reactor.core.publisher.Mono;
import reactor.netty.DisposableServer;
import reactor.netty.http.observability.ReactorNettyPropagatingReceiverTracingObservationHandler;
import reactor.netty.http.server.HttpServer;
import zipkin2.reporter.AsyncReporter;
import zipkin2.reporter.brave.ZipkinSpanHandler;
import zipkin2.reporter.urlconnection.URLConnectionSender;

import static reactor.netty.Metrics.OBSERVATION_REGISTRY;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		init(); <i class="conum" data-value="1"></i><b>(1)</b>

		DisposableServer server =
				HttpServer.create()
				          .metrics(true, s -&gt; {
				              if (s.startsWith("/stream/")) { <i class="conum" data-value="2"></i><b>(2)</b>
				                  return "/stream/{n}";
				              }
				              return s;
				          }) <i class="conum" data-value="3"></i><b>(3)</b>
				          .route(r -&gt; r.get("/stream/{n}",
				              (req, res) -&gt; res.sendString(Mono.just(req.param("n")))))
				          .bindNow();

		server.onDispose()
		      .block();
	}

	/**
	 * This setup is based on
	 * &lt;a href="https://micrometer.io/docs/tracing#_micrometer_tracing_brave_setup"&gt;Micrometer Tracing Brave Setup&lt;/a&gt;.
	 */
	static void init() {
		SpanHandler spanHandler = ZipkinSpanHandler
				.create(AsyncReporter.create(URLConnectionSender.create("http://localhost:9411/api/v2/spans")));

		StrictCurrentTraceContext braveCurrentTraceContext = StrictCurrentTraceContext.create();

		CurrentTraceContext bridgeContext = new BraveCurrentTraceContext(braveCurrentTraceContext);

		Tracing tracing =
				Tracing.newBuilder()
				       .currentTraceContext(braveCurrentTraceContext)
				       .supportsJoin(false)
				       .traceId128Bit(true)
				       .sampler(Sampler.ALWAYS_SAMPLE)
				       .addSpanHandler(spanHandler)
				       .localServiceName("reactor-netty-examples")
				       .build();

		brave.Tracer braveTracer = tracing.tracer();

		Tracer tracer = new BraveTracer(braveTracer, bridgeContext, new BraveBaggageManager());

		Propagator propagator = new BravePropagator(tracing);

		OBSERVATION_REGISTRY.observationConfig()
		                    .observationHandler(new ReactorNettyPropagatingReceiverTracingObservationHandler(tracer, propagator));
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initializes Brave, Zipkin, and the Observation registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Templated URIs are used as an URI tag value when possible.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Enables the built-in integration with Micrometer.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The result in <code>Zipkin</code> looks like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/http-server-tracing.png" alt="http server tracing">
</div>
</div>
<div class="sect2">
<h3 id="access-current-observation"><a class="anchor" href="#access-current-observation"></a>12.1. Access Current Observation</h3>
<div class="paragraph">
<p>Project Micrometer provides <a href="https://micrometer.io/docs/contextPropagation"><code>a library</code></a> that assists with context propagation across
different types of context mechanisms such as <code>ThreadLocal</code>, <code>Reactor Context</code> and others.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use this library in a custom <code>ChannelHandler</code>:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/tracing/custom/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import brave.Tracing;
import brave.handler.SpanHandler;
import brave.propagation.StrictCurrentTraceContext;
import brave.sampler.Sampler;
import io.micrometer.context.ContextSnapshot;
import io.micrometer.tracing.CurrentTraceContext;
import io.micrometer.tracing.Tracer;
import io.micrometer.tracing.brave.bridge.BraveBaggageManager;
import io.micrometer.tracing.brave.bridge.BraveCurrentTraceContext;
import io.micrometer.tracing.brave.bridge.BravePropagator;
import io.micrometer.tracing.brave.bridge.BraveTracer;
import io.micrometer.tracing.propagation.Propagator;
import io.netty.channel.ChannelHandler;
import io.netty.channel.ChannelHandlerContext;
import io.netty.channel.ChannelOutboundHandlerAdapter;
import io.netty.channel.ChannelPromise;
import reactor.core.publisher.Mono;
import reactor.netty.DisposableServer;
import reactor.netty.http.observability.ReactorNettyPropagatingReceiverTracingObservationHandler;
import reactor.netty.http.server.HttpServer;
import zipkin2.reporter.AsyncReporter;
import zipkin2.reporter.brave.ZipkinSpanHandler;
import zipkin2.reporter.urlconnection.URLConnectionSender;

import static reactor.netty.Metrics.OBSERVATION_REGISTRY;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		init(); <i class="conum" data-value="1"></i><b>(1)</b>

		DisposableServer server =
				HttpServer.create()
				          .metrics(true, s -&gt; {
				              if (s.startsWith("/stream/")) { <i class="conum" data-value="2"></i><b>(2)</b>
				                  return "/stream/{n}";
				              }
				              return s;
				          }) <i class="conum" data-value="3"></i><b>(3)</b>
				          .doOnConnection(conn -&gt; conn.addHandlerLast(CustomChannelOutboundHandler.INSTANCE)) <i class="conum" data-value="4"></i><b>(4)</b>
				          .route(r -&gt; r.get("/stream/{n}",
				              (req, res) -&gt; res.sendString(Mono.just(req.param("n")))))
				          .bindNow();

		server.onDispose()
		      .block();
	}

	static final class CustomChannelOutboundHandler extends ChannelOutboundHandlerAdapter {

		static final ChannelHandler INSTANCE = new CustomChannelOutboundHandler();

		@Override
		public boolean isSharable() {
			return true;
		}

		@Override
		public void write(ChannelHandlerContext ctx, Object msg, ChannelPromise promise) {
			try (ContextSnapshot.Scope scope = ContextSnapshot.setAllThreadLocalsFrom(ctx.channel())) {
				System.out.println("Current Observation in Scope: " + OBSERVATION_REGISTRY.getCurrentObservation());
				//"FutureReturnValueIgnored" this is deliberate
				ctx.write(msg, promise);
			}
			System.out.println("Current Observation: " + OBSERVATION_REGISTRY.getCurrentObservation());
		}
	}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initializes Brave, Zipkin, and the Observation registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Templated URIs are used as an URI tag value when possible.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Enables the built-in integration with Micrometer.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Custom <code>ChannelHandler</code> that uses context propagation library. This concrete example overrides only
<code>ChannelOutboundHandlerAdapter#write</code>, if it is needed, the same logic can be used for the rest of the methods.
Also, this concrete example sets all <code>ThreadLocal</code> values for which there is a value in the given <code>Channel</code>,
if another behaviour is needed please check <a href="https://micrometer.io/docs/contextPropagation"><code>context propagation library API</code></a>.
For example, you may want to set only some of the <code>ThreadLocal</code> values.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you enable Reactor Netty tracing within a framework, you may need to let Reactor Netty use the <code>ObservationRegistry</code> created by this framework.
For this purpose you need to invoke <a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/Metrics.html#observationRegistry-io.micrometer.observation.ObservationRegistry-"><code>reactor.netty.Metrics#observationRegistry</code></a>.
You may also need to configure the Reactor Netty <code>ObservationHandlers</code> using the API provided by the framework.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="unix-domain-sockets"><a class="anchor" href="#unix-domain-sockets"></a>13. Unix Domain Sockets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>HTTP</code> server supports Unix Domain Sockets (UDS) when native transport is in use.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use UDS support:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/uds/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import io.netty.channel.unix.DomainSocketAddress;
import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .bindAddress(() -&gt; new DomainSocketAddress("/tmp/test.sock")) <i class="conum" data-value="1"></i><b>(1)</b>
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specifies <code>DomainSocketAddress</code> that will be used</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-server-timeout-configuration"><a class="anchor" href="#http-server-timeout-configuration"></a>14. Timeout Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes various timeout configuration options that can be used in <code>HttpServer</code>.
Configuring a proper timeout may improve or solve issues in the communication process.
The configuration options can be grouped as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#http-server-request-timeout">Request Timeout</a></p>
</li>
<li>
<p><a href="#http-server-connection-timeout">Connection Timeout</a></p>
</li>
<li>
<p><a href="#http-server-ssl-tls-timeout">SSL/TLS Timeout</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="http-server-request-timeout"><a class="anchor" href="#http-server-request-timeout"></a>14.1. Request Timeout</h3>
<div class="paragraph">
<p>The following listing shows all available request timeout configuration options.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>readTimeout</code> - the maximum time between each network-level read operation while reading a given request content (resolution: ms)</p>
</li>
<li>
<p><code>requestTimeout</code> - the maximum time for reading a given request content (resolution: ms).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is always a good practice to configure a read/request timeout.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To customize the default settings, you can configure <code>HttpServer</code> as follows:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/read/timeout/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

import java.time.Duration;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .readTimeout(Duration.ofSeconds(5))     <i class="conum" data-value="1"></i><b>(1)</b>
				          .requestTimeout(Duration.ofSeconds(30)) <i class="conum" data-value="2"></i><b>(2)</b>
				          .handle((request, response) -&gt; request.receive().then())
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configures the read timeout to 5 second.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configures the request timeout to 30 second.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="http-server-connection-timeout"><a class="anchor" href="#http-server-connection-timeout"></a>14.2. Connection Timeout</h3>
<div class="paragraph">
<p>The following listing shows all available connection timeout configuration options.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>idleTimeout</code> - The maximum time (resolution: ms) that this connection stays opened and waits for HTTP request.
Once the timeout is reached, the connection is closed. By default,
<a href="https://projectreactor.io/docs/netty/1.1.18-SNAPSHOT/api/reactor/netty/http/server/HttpServer.html#idleTimeout-java.time.Duration-"><code>idleTimeout</code></a> is not specified,
this indicates no timeout (i.e. infinite), which means the connection is closed only if one of the peers decides to close it explicitly.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is always a good practice to configure an idle timeout.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To customize the default settings, you can configure <code>HttpServer</code> as follows:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/idle/timeout/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.netty.DisposableServer;
import reactor.netty.http.server.HttpServer;

import java.time.Duration;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		DisposableServer server =
				HttpServer.create()
				          .idleTimeout(Duration.ofSeconds(1)) <i class="conum" data-value="1"></i><b>(1)</b>
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configures the default idle timeout to 1 second.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="http-server-ssl-tls-timeout"><a class="anchor" href="#http-server-ssl-tls-timeout"></a>14.3. SSL/TLS Timeout</h3>
<div class="paragraph">
<p><code>HttpServer</code> supports the SSL/TLS functionality provided by Netty.</p>
</div>
<div class="paragraph">
<p>The following list describes the available timeout configuration options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>handshakeTimeout</code> - Use this option to configure the SSL handshake timeout (resolution: ms). Default: 10s.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You should consider increasing the SSL handshake timeout when expecting slow network connections.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><code>closeNotifyFlushTimeout</code> - Use this option to configure the SSL <code>close_notify</code> flush timeout (resolution: ms). Default: 3s.</p>
</li>
<li>
<p><code>closeNotifyReadTimeout</code> - Use this option to configure the SSL <code>close_notify</code> read timeout (resolution: ms). Default: 0s.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To customize the default settings, you can configure <code>HttpServer</code> as follows:</p>
</div>
<div class="listingblock">
<div class="title">example$reactor-netty-examples/src/main/java/reactor/netty/examples/documentation/http/server/security/custom/Application.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="fold-block is-hidden-folded">import reactor.netty.DisposableServer;
import reactor.netty.http.Http11SslContextSpec;
import reactor.netty.http.server.HttpServer;

import java.io.File;
import java.time.Duration;

</span><span class="fold-block">public class Application {

	public static void main(String[] args) {
		File cert = new File("certificate.crt");
		File key = new File("private.key");

		Http11SslContextSpec http11SslContextSpec = Http11SslContextSpec.forServer(cert, key);

		DisposableServer server =
				HttpServer.create()
				          .secure(spec -&gt; spec.sslContext(http11SslContextSpec)
				                              .handshakeTimeout(Duration.ofSeconds(30))         <i class="conum" data-value="1"></i><b>(1)</b>
				                              .closeNotifyFlushTimeout(Duration.ofSeconds(10))  <i class="conum" data-value="2"></i><b>(2)</b>
				                              .closeNotifyReadTimeout(Duration.ofSeconds(10)))  <i class="conum" data-value="3"></i><b>(3)</b>
				          .bindNow();

		server.onDispose()
		      .block();
	}
}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configures the SSL handshake timeout to 30 seconds.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configures the SSL <code>close_notify</code> flush timeout to 10 seconds.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configures the SSL <code>close_notify</code> read timeout to 10 seconds.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="tcp-client.html">TCP Client</a></span>
  <span class="next"><a href="http-client.html">HTTP Client</a></span>
</nav>
</article>
  </div>
</main>
<div class="modal micromodal-slide" id="modal-versions" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
        <div class="modal__container" role="dialog" aria-modal="true">
            <main class="modal__content" id="modal-versions-content">
              <button data-micromodal-close class="modal-versions-close">
                <svg width="28px" height="28px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><defs><style>.cls-1h{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px;}</style></defs><title/><g id="cross"><line class="cls-1h" x1="7" x2="25" y1="7" y2="25"/><line class="cls-1h" x1="7" x2="25" y1="25" y2="7"/></g></svg>
              </button>
              <div class="colset">
                <div class="col-left">
                  <ul class="nav-versions">
                    <li class="component is-current">
                      <a class="title" href="index.html">Reactor Netty Reference Guide</a>
                      <ul class="versions">
                        <li class="version is-current is-latest">
                          <a href="index.html">
                            1.1.18-SNAPSHOT<span class="current">current</span>
                          </a>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="col-right">
                  <ul class="projects">
  <li>
    Related Spring Documentation
    <ul class="projects-list">
        <li>
<a href="https://docs.spring.io/spring-framework/reference/">
  Spring Framework
</a>
</li>
        <li>
<a class="anchor"><i class="fa fa-angle-right" aria-hidden="true"></i></a>
  Spring Cloud
<ul>
    <li>
<a href="https://docs.spring.io/spring-cloud-build/reference/">
  Spring Cloud Build
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-cloud-bus/reference/">
  Spring Cloud Bus
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-cloud-circuitbreaker/reference/">
  Spring Cloud Circuit Breaker
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-cloud-commons/reference/">
  Spring Cloud Commons
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-cloud-config/reference/">
  Spring Cloud Config
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-cloud-consul/reference/">
  Spring Cloud Consul
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-cloud-contract/reference/">
  Spring Cloud Contract
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-cloud-function/reference/">
  Spring Cloud Function
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-cloud-gateway/reference/">
  Spring Cloud Gateway
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-cloud-kubernetes/reference/">
  Spring Cloud Kubernetes
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-cloud-netflix/reference/">
  Spring Cloud Netflix
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-cloud-openfeign/reference/">
  Spring Cloud OpenFeign
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-cloud-stream/reference/">
  Spring Cloud Stream
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-cloud-task/reference/">
  Spring Cloud Task
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-cloud-vault/reference/">
  Spring Cloud Vault
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-cloud-zookeeper/reference/">
  Spring Cloud Zookeeper
</a>
</li>
</ul>
</li>
        <li>
<a class="anchor"><i class="fa fa-angle-right" aria-hidden="true"></i></a>
  Spring Data
<ul>
    <li>
<a href="https://docs.spring.io/spring-data/cassandra/reference/">
  Spring Data Cassandra
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-data/commons/reference/">
  Spring Data Commons
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-data/couchbase/reference/">
  Spring Data Couchbase
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-data/elasticsearch/reference/">
  Spring Data Elasticsearch
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-data/jpa/reference/">
  Spring Data JPA
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-data/keyvalue/reference/">
  Spring Data KeyValue
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-data/ldap/reference/">
  Spring Data LDAP
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-data/mongodb/reference/">
  Spring Data MongoDB
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-data/neo4j/reference/">
  Spring Data Neo4j
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-data/redis/reference/">
  Spring Data Redis
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-data/relational/reference/">
  Spring Data JDBC &amp; R2DBC
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-data/rest/reference/">
  Spring Data REST
</a>
</li>
</ul>
</li>
        <li>
<a href="https://docs.spring.io/spring-integration/reference/">
  Spring Integration
</a>
</li>
        <li>
<a href="https://docs.spring.io/spring-batch/reference/">
  Spring Batch
</a>
</li>
        <li>
<a class="anchor"><i class="fa fa-angle-right" aria-hidden="true"></i></a>
<a href="https://docs.spring.io/spring-security/reference/">
  Spring Security
</a>
<ul>
    <li>
<a href="https://docs.spring.io/spring-authorization-server/reference/">
  Spring Authorization Server
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-ldap/reference/">
  Spring LDAP
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-security-kerberos/reference/">
  Spring Security Kerberos
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-session/reference/">
  Spring Session
</a>
</li>
    <li>
<a href="https://docs.spring.io/spring-vault/reference/">
  Spring Vault
</a>
</li>
</ul>
</li>
        <li>
<a href="https://docs.spring.io/spring-ai/reference/">
  Spring AI
</a>
</li>
        <li>
<a href="https://docs.spring.io/spring-amqp/reference/">
  Spring AMQP
</a>
</li>
        <li>
<a href="https://docs.spring.io/spring-cli/reference/">
  Spring CLI
</a>
</li>
        <li>
<a href="https://docs.spring.io/spring-graphql/reference/">
  Spring GraphQL
</a>
</li>
        <li>
<a href="https://docs.spring.io/spring-kafka/reference/">
  Spring for Apache Kafka
</a>
</li>
        <li>
<a href="https://docs.spring.io/spring-modulith/reference/">
  Spring Modulith
</a>
</li>
        <li>
<a href="https://docs.spring.io/spring-pulsar/reference/">
  Spring for Apache Pulsar
</a>
</li>
        <li>
<a href="https://docs.spring.io/spring-shell/reference/">
  Spring Shell
</a>
</li>
    </ul>
  </li
  <li><a href="spring-projects.html">All Docs...</a></li>
</ul>
                </div>
              </div>
            </main>
        </div>
    </div>
</div>

</div>
<footer class="footer flex">
    <div id="spring-links flex">
        <img id="reactorlogo-footer" src="./_/img/reactor-logo.svg" alt="Reactor">
        <img id="reactorlogo-footer-dark" src="./_/img/reactor-logo-dark.svg" alt="Reactor">
        <p class="smallest antialiased">Copyright  2005 - <script>var d = new Date();
        document.write(d.getFullYear());</script> Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.<br /><a href="https://www.vmware.com/help/legal.html">Terms of Use</a>  <a href="https://www.vmware.com/help/privacy.html" rel="noopener noreferrer">Privacy</a>  <a href="https://spring.io/trademarks">Trademark Guidelines</a> <span id="thank-you-mobile"> <a href="https://spring.io/thank-you">Thank you</a></span>  <a href="https://www.vmware.com/help/privacy/california-privacy-rights.html">Your California Privacy Rights</a>  <a class="ot-sdk-show-settings">Cookie Settings</a> <span id="teconsent"></span></p>
        <p class="smallest antialiased has-gray-text">Apache, Apache Tomcat, Apache Kafka, Apache Cassandra&trade;, and Apache Geode&trade; are trademarks or registered trademarks of the Apache Software Foundation in the United States and/or other countries. Java&trade;, Java&trade; SE, Java&trade; EE, and OpenJDK&trade; are trademarks of Oracle and/or its affiliates. Kubernetes is a registered trademark of the Linux Foundation in the United States and other countries. Linux is the registered trademark of Linus Torvalds in the United States and other countries. Windows and Microsoft Azure are registered trademarks of Microsoft Corporation. AWS and Amazon Web Services are trademarks or registered trademarks of Amazon.com Inc. or its affiliates. All other trademarks and copyrights are property of their respective owners and are only mentioned for informative purposes. Other names may be trademarks of their respective owners.</p>
    </div>
    <div id="social-icons" class="flex jc-between">
        <a href="https://www.youtube.com/user/SpringSourceDev" title="Youtube"><svg id="youtube-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40"><circle class="cls-1" cx="20" cy="20" r="20"/><path class="cls-2" d="M30.91,14.53a2.89,2.89,0,0,0-2-2C27.12,12,20,12,20,12s-7.12,0-8.9.47a2.9,2.9,0,0,0-2,2A30.56,30.56,0,0,0,8.63,20a30.44,30.44,0,0,0,.46,5.47,2.89,2.89,0,0,0,2,2C12.9,28,20,28,20,28s7.12,0,8.9-.47a2.87,2.87,0,0,0,2-2A30.56,30.56,0,0,0,31.37,20,28.88,28.88,0,0,0,30.91,14.53ZM17.73,23.41V16.59L23.65,20Z"/></svg></a>
        <a href="https://github.com/spring-projects" title="Github"><svg id="github-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 75.93 75.93"><path class="cls-1" d="M38,0a38,38,0,1,0,38,38A38,38,0,0,0,38,0Z"/></g><path class="cls-2" d="M38,15.59A22.95,22.95,0,0,0,30.71,60.3c1.15.21,1.57-.5,1.57-1.11s0-2,0-3.9c-6.38,1.39-7.73-3.07-7.73-3.07A6.09,6.09,0,0,0,22,48.86c-2.09-1.42.15-1.39.15-1.39a4.81,4.81,0,0,1,3.52,2.36c2,3.5,5.37,2.49,6.67,1.91a4.87,4.87,0,0,1,1.46-3.07c-5.09-.58-10.45-2.55-10.45-11.34a8.84,8.84,0,0,1,2.36-6.15,8.29,8.29,0,0,1,.23-6.07s1.92-.62,6.3,2.35a21.82,21.82,0,0,1,11.49,0c4.38-3,6.3-2.35,6.3-2.35a8.29,8.29,0,0,1,.23,6.07,8.84,8.84,0,0,1,2.36,6.15c0,8.81-5.37,10.75-10.48,11.32a5.46,5.46,0,0,1,1.56,4.25c0,3.07,0,5.54,0,6.29s.42,1.33,1.58,1.1A22.94,22.94,0,0,0,38,15.59Z"/></svg></a>
        <a href="https://twitter.com/springcentral" title="Twitter"><svg id="twitter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 75.93 75.93"><circle class="cls-1" cx="37.97" cy="37.97" r="37.97"/><path id="Twitter-2" data-name="Twitter" class="cls-2" d="M55.2,22.73a15.43,15.43,0,0,1-4.88,1.91,7.56,7.56,0,0,0-5.61-2.49A7.78,7.78,0,0,0,37,30a7.56,7.56,0,0,0,.2,1.79,21.63,21.63,0,0,1-15.84-8.23,8,8,0,0,0,2.37,10.52,7.66,7.66,0,0,1-3.48-1v.09A7.84,7.84,0,0,0,26.45,41a7.54,7.54,0,0,1-2,.28A7.64,7.64,0,0,1,23,41.09a7.71,7.71,0,0,0,7.18,5.47,15.21,15.21,0,0,1-9.55,3.37,15.78,15.78,0,0,1-1.83-.11,21.41,21.41,0,0,0,11.78,3.54c14.13,0,21.86-12,21.86-22.42,0-.34,0-.68,0-1a15.67,15.67,0,0,0,3.83-4.08,14.9,14.9,0,0,1-4.41,1.24A7.8,7.8,0,0,0,55.2,22.73Z"/></svg></a>
    </div>
</footer>
<script src="./_/js/vendor/import.js"></script>
<script src="./_/js/site.js"></script>
<script async src="./_/js/vendor/highlight.js"></script>
<script async src="./_/js/vendor/asciidoctor-tabs.js" data-sync-storage-key="docs:preferred-tab"></script>

<div class="modal micromodal-slide" id="modal-1" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
        <div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-1-title">
            <main class="modal__content" id="modal-1-content">
                <div id="searchbox"></div>
                <div id="counter"></div>
                <div class="search-link-box">
                    <a class="search-link" href="search.html">Search in all Spring Docs</a>
                </div>
                <div class="search-by">
                    <a target="_blank" rel="noopener noreferrer" href="https://www.algolia.com/" aria-label="Search by Algolia">
                        <img class="light" width="140" src="./_/img/algolia-light.svg" />
                        <img class="dark" width="140" src="./_/img/algolia-dark.svg" />
                    </a>
                </div>
                <div id="hits"></div>
            </main>
        </div>
    </div>
</div>

<script src="https://unpkg.com/hotkeys-js/dist/hotkeys.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.17.0/dist/algoliasearch-lite.umd.js" integrity="sha256-Lf9DrpGmcRip6OQzbcL6lnvNmoZNSKpyQX5pMlwatWE=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.54.1/dist/instantsearch.production.min.js" integrity="sha256-xYsZPDeNjYNTBWLvqD2Lxe98hOxcDgOHyMPfz4tVAbk=" crossorigin="anonymous"></script>
<script async id="search-script" src="./_/js/vendor/search.js" data-app-id="TGS4XRGX3V" data-api-key="da671ceec1f84f80f280884a6a91bde5" data-index-name="reactor" data-stylesheet="./_/css/vendor/search.css" data-page-version="1.1.18" data-page-component="reactor-netty"></script>
  </body>
</html>
