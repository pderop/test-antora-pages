name: auto-index
on:
  workflow_dispatch:
#  push:
#    branches: # For branches, better to list them explicitly than regexp include
#      - gh-pages
  workflow_run:
    workflows: [ pages-build-deployment ]
    types:
      - completed
#  workflow_run:
#    workflows: ["pages-build-deployment"]
#    types:
#      - completed

jobs:
  auto-index:
    runs-on: ubuntu-latest
    name: Directory Listings Index
    env:
      CI_COMMIT_MESSAGE: AutoIndex
      CI_COMMIT_AUTHOR: ${{ github.event.repository.name }}
      CI_COMMIT_EMAIL: $GITHUB_TRIGGERING_ACTOR@users.noreply.github.com
    permissions:
      contents: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Auto Index
        run: |-
          .github/scripts/auto-index.sh .
          git status

      - name: Commit directory index
        run: |-
          git config --global user.name "${{ env.CI_COMMIT_AUTHOR }}"
          git config --global user.email "${{ env.CI_COMMIT_EMAIL }}"
          git add index.html
          git add docs
          git commit --allow-empty -m "Directory listing indexes"
          git push origin gh-pages:gh-pages

